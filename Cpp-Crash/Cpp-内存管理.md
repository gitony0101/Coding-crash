# 变量与内存分区模型

## 内存四区 代码区 全局区 栈区 堆区

四区的意义：不同区域存放的数据，赋予不同的生命周期，编程更灵活

### 程序运行前

代码区： 存放函数体二进制代码，由操作系统进行管理

- 存放 CPU 执行的机器指令，代码区是共享、只读的

全局区： 全局变量 静态变量 常量 都存放在此

- 上述变量常量存储在内存中不同的位置
  - 局部和全局不在一个区，常量区中存放 const 修饰的全局常量 和 字符串常量
- 该区域数据在程序结束后由操作系统释放

### 程序运行后

栈区 stack： 由编译器自动分配释放，存放函数的参数值，局部变量等

- 注意：不要返回局部变量的地址，栈区开辟的数据由编译器自动释放

堆区 heap：由程序员分配和释放，若不释放，程序结束时由操作系统回收

- 手动用 new 进行开辟内存，用 delete 释放内存

### 堆和栈的区别

1. 管理方式不同： 栈是由编译器自动申请和释放空间，堆是需要程序员手动申请和释放；
2. 空间大小不同： 栈的空间是有限的，在 32 位平台下，VC6 下默认为 1M，堆最大可以到 4G；
3. 能否产生碎片： 栈和数据结构中的栈原理相同，在弹出一个元素之前，上一个已经弹出了，不会产生碎片，如果不停地调用 malloc、free 对造成内存碎片很多；
4. 生长方向不同： **堆生长方向是向上的，也就是向着内存地址增加的方向，栈刚好相反，向着内存减小的方向生长**。
5. 分配方式不同：
   - 堆都是动态分配的，没有静态分配的堆。
   - 栈有静态分配和动态分配。静态分配是编译器完成的，比如局部变量的分配。动态分配由 malloc 函数进行分配，但是栈的动态分配和堆是不同的，它的动态分配是由编译器进行释放，无需我们手工实现。
6. 分配效率不同： 栈的效率比堆高很多。
   - 栈是机器系统提供的数据结构，计算机在底层提供栈的支持，分配专门的寄存器来存放栈的地址，压栈出栈都有相应的指令，因此比较快。堆是由库函数提供的，机制很复杂，库函数会按照一定的算法进行搜索内存，因此比较慢。

### Temp

[vector 动态二维数组（容器的容器）占用内存分析](https://blog.csdn.net/kangroger/article/details/38386099)
